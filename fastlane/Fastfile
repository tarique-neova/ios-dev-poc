default_platform :ios
platform :ios do

  before_all do
    setup_circle_ci
  end

  lane :upload_release do

    get_provisioning_profile(
        development: false,
        team_id: "2ZBVR8AP3W",
        provisioning_name: "distribution",
        app_identifier: "com.neovasolutions.ios-dev-poc"
    )

    increment_build_number(
      build_number: "$CIRCLE_BUILD_NUM"
    )

  api_key = app_store_connect_api_key(
    key_id: "WXYFK8CF5D",
    issuer_id: "6701bcf4-21c5-4e25-9fd7-76af487a8e20",
    key_content: "-----BEGIN PRIVATE KEY-----\nMIGTAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBHkwdwIBAQQgz8S6G+oCbY+DlpDO44h91CyqPHc1f1hDIvO90XyVyi+gCgYIKoZIzj0DAQehRANCAATRh6sKuK3JunOpDqvb1xdkwZ3kbmiAueV/XaTNdZ/JNlbOW33ikt7yrA9jCDoukR0mqh1PisbBdCXuqJmmAkcC\n-----END PRIVATE KEY-----"
  )

    # Build your iOS app
    gym(scheme: "ios-dev-poc")
    # Upload the app to App Store Connect
    pilot(api_key: api_key)
  end
end
