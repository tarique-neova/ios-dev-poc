default_platform :ios
platform :ios do

  before_all do
    setup_circle_ci
  end

  lane :upload_release do
    increment_build_number(
      build_number: "$CIRCLE_BUILD_NUM"
    )

  api_key = app_store_connect_api_key(
    key_id: "WXYFK8CF5D",
    issuer_id: "6701bcf4-21c5-4e25-9fd7-76af487a8e20",
    key_filepath: "AuthKey_WXYFK8CF5D.p8",
    duration: 1200, # optional (maximum 1200)
    in_house: false # optional but may be required if using match/sigh
  )
    # Build your iOS app
    gym(scheme: "ios-dev-poc")
    # Upload the app to App Store Connect
    pilot(api_key: api_key)
  end
end
